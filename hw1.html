<!DOCTYPE html>
<html>
<head>
<title>
</title>
<style>
#heading{
	text-align: center;
	position:absolute;
	width:100vw;
}
</style>
</head>
<body style='overflow:hidden'> 

<div id='heading'>
	<h3 style = "color:red">hw1 - stop when 60s</h3>
	<button id="clockStart">start</button>
	<br><p id="msg"></p>
</div>

<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<script>
javascript:(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='https://mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()
// my script

var camera, scene, renderer;
var clock = new THREE.Clock();
var clockStart = false;
var watch = new THREE.Group();

$("#clockStart").click(function() {
	clockStart = !clockStart;
	if(clockStart){
		$('#clockStart').text('pause');
		setTimeout (timing, 0);
	}
	else $('#clockStart').text('start');
});

init();
animate();

function init() {
	scene = new THREE.Scene();
	camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 10000);
	camera.position.set (0,0,30);
	renderer = new THREE.WebGLRenderer({antialias: true});
	renderer.setSize(window.innerWidth, window.innerHeight);
	renderer.setClearColor(0x888888);
	window.addEventListener('resize', onWindowResize, false);
	document.body.appendChild(renderer.domElement);
	let controls = new THREE.OrbitControls(camera, renderer.domElement);
	
	var light = new THREE.PointLight( 0xffffff, 1, 1000 );
	scene.add( light );
	
	buildClock();
	scene.add(watch);
}

function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
	var dt = clock.getDelta();
	
	renderer.render(scene,camera);
	requestAnimationFrame( animate );
}

function buildClock(){
	let loader = new THREE.TextureLoader();
	loader.crossOrigin = '';
	
	let texMat = new THREE.MeshBasicMaterial({
		map: loader.load('https://i.imgur.com/8MXF8tx.png'),
		alphaTest: 0.5,
		side: THREE.DoubleSide
	});
	let clockMesh = new THREE.Mesh(new THREE.CircleGeometry(8, 32), texMat);
	
	texMat = new THREE.MeshBasicMaterial({
		map: loader.load('https://i.imgur.com/yQnsgUm.png'),
		alphaTest: 0.5,
		side: THREE.DoubleSide, 
		transparent: true, 
		opacity: 0.7
	});
	let sector = new THREE.Mesh(new THREE.CircleGeometry(7.8, 32, Math.PI/2 - Math.PI/6, Math.PI/3), texMat);
	sector.position.z = 0.1;
	
	watch.add(clockMesh, sector);
}

function timing(){
	if(!clockStart) return;
	if(this.count === 1200){
		this.count = 0;
		return;
	}
	
	this.count = (this.count === undefined) ? 0 : this.count;
	this.count += 1;
	
	watch.children[0].rotation.z -= Math.PI/600;
	watch.children[1].rotation.z = watch.children[0].rotation.z;
	$('#msg').text((this.count/20).toFixed() + 's');
	
	//sector animate
	let tmp = this.count % 40;
	if(tmp < 10)
		watch.children[1].rotation.z += tmp * Math.PI/300;
	else if(tmp < 20)
		watch.children[1].rotation.z += (20 - tmp) * Math.PI/300;
	else if(tmp < 30)
		watch.children[1].rotation.z -= (tmp - 20) * Math.PI/300;
	else if(tmp < 40)
		watch.children[1].rotation.z -= (40 - tmp) * Math.PI/300;
	
	setTimeout(timing, 50);
}
</script>

</body>
</html>